<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">

	<Product Id="*"
			 Name="$(var.ProductName)"
			 Language="1033"
			 Version="$(var.ProductVersion)"
			 Manufacturer="$(var.Manufacturer)"
			 UpgradeCode="{42C9E694-355E-4D5E-BCC7-2FC2F50AC4BE}">

		<Package InstallerVersion="500"
				 Compressed="yes"
				 InstallScope="perMachine" />

		<MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
		<MediaTemplate />

		<Feature Id="ProductFeature"
         Title="$(var.ProductName)"
         Description="$(var.ProductName) core application and supporting files"
         Level="1">

			<!-- Bring in all harvested files from publish folder -->
			<ComponentGroupRef Id="AppFilesGroup" />

			<!-- Explicitly pull in your main EXE -->
			<ComponentRef Id="MainExeComponent" />

			<!-- Optional: add specific oneâ€‘off components -->
			<!-- <ComponentRef Id="LicenseFileComponent" /> -->
			<!-- <ComponentRef Id="ConfigComponent" /> -->

			<!-- Optional: add groups for shortcuts, registry entries, etc. -->
			<!-- <ComponentGroupRef Id="ShortcutGroup" /> -->
			<!-- <ComponentGroupRef Id="RegistryGroup" /> -->

		</Feature>

		<Icon Id="AppIcon" SourceFile="Assets\AdvTechLogo.ico" />
		<Property Id="ARPPRODUCTICON" Value="AppIcon" />

	</Product>

	<!-- Directory structure -->
	<Fragment>
		<Directory Id="TARGETDIR" Name="SourceDir">
			<Directory Id="ProgramFilesFolder">
				<Directory Id="INSTALLFOLDER" Name="$(var.ProductName)" />
			</Directory>
		</Directory>
	</Fragment>

	<!-- Main EXE component -->
	<Fragment>
		<DirectoryRef Id="INSTALLFOLDER">
			<Component Id="MainExeComponent" Guid="PUT-GUID-HERE">
				<File Id="MainExeFile"
					  Source="$(var.WS_Setup_6_UI_TargetPath)"
					  KeyPath="yes" />
			</Component>
		</DirectoryRef>
	</Fragment>

	<!-- Custom Action to run EXE (WiX v6 style) -->
	<Fragment>
		<CustomAction Id="RunMainExe"
					  BinaryKey="MainExeFile"
					  ExeCommand=""
					  Execute="deferred"
					  Impersonate="no"
					  Return="asyncNoWait" />

		<InstallExecuteSequence>
			<Custom Action="RunMainExe" After="InstallFinalize">
				NOT Installed
			</Custom>
		</InstallExecuteSequence>
	</Fragment>

</Wix>