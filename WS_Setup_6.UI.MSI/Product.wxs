<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">

	<Package Name="$(var.ProductName)"
			 Language="1033"
			 Version="$(var.ProductVersion)"
			 Manufacturer="$(var.Manufacturer)"
			 UpgradeCode="42C9E694-355E-4D5E-BCC7-2FC2F50AC4BE"
			 InstallerVersion="500"
			 Compressed="yes"
			 Scope="perMachine">

		<MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
		<MediaTemplate />

		<Feature Id="ProductFeature"
				 Title="$(var.ProductName)"
				 Description="$(var.ProductName) core application and supporting files"
				 Level="1">

			<!-- Bring in all harvested files from publish folder -->
			<ComponentGroupRef Id="ProductComponents" />

			<!-- Optional: explicitly include main EXE if you want to guarantee it -->
			<!-- <ComponentRef Id="MainExeComponent" /> -->

			<!-- Optional: add other specific components -->
			<!-- <ComponentRef Id="LicenseFileComponent" /> -->
			<!-- <ComponentRef Id="ConfigComponent" /> -->

		</Feature>

		<Icon Id="AppIcon" SourceFile="Assets\AdvTechLogo.ico" />
		<Property Id="ARPPRODUCTICON" Value="AppIcon" />

		<!-- Directory structure -->
		<StandardDirectory Id="ProgramFilesFolder">
			<Directory Id="INSTALLFOLDER" Name="$(var.ProductName)" />
		</StandardDirectory>

		<!-- Main EXE component -->
		<DirectoryRef Id="INSTALLFOLDER">
			<Component Id="MainExeComponent" Guid="b8a1f0e5-3d4a-4b6a-9f2f-8a6f3b8c9d7e">
				<File Id="MainExeFile"
					  Source="$(var.WS_Setup_6_UI_TargetPath)"
					  KeyPath="yes" />
			</Component>
		</DirectoryRef>

		<!-- Custom Action to run EXE after install -->
		<CustomAction Id="RunMainExe"
					  FileRef="MainExeFile"
					  ExeCommand=""
					  Execute="deferred"
					  Impersonate="no"
					  Return="asyncNoWait" />

		<InstallExecuteSequence>
			<Custom Action="RunMainExe"
					After="InstallFinalize">
			</Custom>
		</InstallExecuteSequence>

	</Package>
</Wix>